<script>
const csvUrl =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQosG1886lb-AuGEol8xxZDg86byv_mYktRIpTU9F9iCQPH4GSkY_xwX5WAYZBLiBDZuUO67pidUvEr/pub?gid=1348530041&single=true&output=csv";

Papa.parse(csvUrl, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function (results) {

    const tbody = document.querySelector("#occupancyTable tbody");
    tbody.innerHTML = "";

    let currentBranch = "";

    results.data.forEach((row) => {

      let branch = (row["Branch"] || "").trim();
      let slot = (row["Slot"] || "").trim();
      let count = parseInt(row["Active Count Today"] || 0);

      // Ignore invalid rows
      if (!slot || isNaN(count)) return;

      // New branch header
      if (branch) {
        currentBranch = branch;

        const br = document.createElement("tr");
        br.className = "branch-row";
        br.innerHTML = `<td colspan="3">${currentBranch}</td>`;
        tbody.appendChild(br);
      }

      // Slot row
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td></td>
        <td class="slot-cell">${slot}</td>
        <td class="count-cell ${count > 50 ? "high" : ""}">${count}</td>
      `;
      tbody.appendChild(tr);
    });
  }
});
</script>